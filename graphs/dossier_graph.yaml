id: dossier_graph
entry: topic_ingest
nodes:
  topic_ingest:
    agent: ingestor
    inputs: [sources]
    outputs: [doc_ids, segment_ids, source_docs, source_segments]
    next: normalize

  normalize:
    agent: normalizer
    inputs: [source_segments]
    outputs: [normalized_segments]
    next: entity_resolution

  entity_resolution:
    agent: entity_resolver
    inputs: [normalized_segments]
    outputs: [entities, relationships]
    next: claim_extraction

  claim_extraction:
    agent: claim_extractor
    inputs: [normalized_segments, entities]
    outputs: [claims]
    next: metric_extraction
    retry:
      max_attempts: 2
      backoff_seconds: 1.0

  metric_extraction:
    agent: metric_extractor
    inputs: [normalized_segments]
    outputs: [metrics, metric_points]
    next: contradiction_check

  contradiction_check:
    agent: contradiction
    inputs: [claims]
    outputs: [contradictions, updated_claim_ids]
    next: snapshot

  snapshot:
    agent: delta
    inputs: [claims, metrics]
    outputs: [snapshot_id, delta_id, delta_json, stability_score]
    next: synthesis

  synthesis:
    agent: synthesizer
    inputs: [claims, metrics, metric_points, delta_json]
    outputs: [synthesis]
    next: publish

  publish:
    agent: publisher
    inputs: [snapshot_id, delta_id]
    outputs: [publish_dir, manifest, artifacts]
    end: true
